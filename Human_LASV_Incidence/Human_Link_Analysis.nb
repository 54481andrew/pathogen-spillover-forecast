(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 11.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[      9456,        357]
NotebookOptionsPosition[      7706,        291]
NotebookOutlinePosition[      8210,        312]
CellTagsIndexPosition[      8167,        309]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["Human Lassa Case Rate", "Title"],

Cell["\<\
This code shows the analyses performed on the system of ordinary differential \
equations in the Appendix. \
\>", "Text"],

Cell[CellGroupData[{

Cell["Define model", "Subchapter"],

Cell["Define the system of ODEs that describe human infection. ", "Text"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"dsdt", " ", "=", " ", 
   RowBox[{"b", " ", "-", " ", 
    RowBox[{"d", " ", "s"}], " ", "-", " ", 
    RowBox[{"F", " ", "s"}], " ", "+", " ", 
    RowBox[{"\[Lambda]", " ", "r"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"didt", " ", "=", " ", 
   RowBox[{
    RowBox[{"F", " ", "s"}], " ", "-", " ", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{"d", " ", "+", " ", "\[Gamma]"}], ")"}], " ", "i"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"drdt", " ", "=", " ", 
   RowBox[{
    RowBox[{"\[Gamma]", " ", "i"}], " ", "-", " ", 
    RowBox[{"d", " ", "r"}], " ", "-", " ", 
    RowBox[{"\[Lambda]", " ", "r"}]}]}], ";"}]}], "Input"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Derive relationship between seroprevalence and new case rate", \
"Subchapter"],

Cell["Find the equilibrium.", "Text"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"eq", " ", "=", " ", 
  RowBox[{"FullSimplify", "[", 
   RowBox[{"Solve", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"dsdt", "\[Equal]", "0"}], ",", " ", 
       RowBox[{"didt", "\[Equal]", "0"}], ",", " ", 
       RowBox[{"drdt", "\[Equal]", "0"}]}], "}"}], ",", " ", 
     RowBox[{"{", 
      RowBox[{"s", ",", "i", ",", "r"}], "}"}]}], "]"}], "]"}]}]], "Input"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"s", "\[Rule]", 
     FractionBox[
      RowBox[{"b", " ", 
       RowBox[{"(", 
        RowBox[{"d", "+", "\[Gamma]"}], ")"}], " ", 
       RowBox[{"(", 
        RowBox[{"d", "+", "\[Lambda]"}], ")"}]}], 
      RowBox[{
       RowBox[{"d", " ", 
        RowBox[{"(", 
         RowBox[{"d", "+", "F"}], ")"}], " ", 
        RowBox[{"(", 
         RowBox[{"d", "+", "\[Gamma]"}], ")"}]}], "+", 
       RowBox[{"d", " ", 
        RowBox[{"(", 
         RowBox[{"d", "+", "F", "+", "\[Gamma]"}], ")"}], " ", 
        "\[Lambda]"}]}]]}], ",", 
    RowBox[{"i", "\[Rule]", 
     FractionBox[
      RowBox[{"b", " ", "F", " ", 
       RowBox[{"(", 
        RowBox[{"d", "+", "\[Lambda]"}], ")"}]}], 
      RowBox[{
       RowBox[{"d", " ", 
        RowBox[{"(", 
         RowBox[{"d", "+", "F"}], ")"}], " ", 
        RowBox[{"(", 
         RowBox[{"d", "+", "\[Gamma]"}], ")"}]}], "+", 
       RowBox[{"d", " ", 
        RowBox[{"(", 
         RowBox[{"d", "+", "F", "+", "\[Gamma]"}], ")"}], " ", 
        "\[Lambda]"}]}]]}], ",", 
    RowBox[{"r", "\[Rule]", 
     FractionBox[
      RowBox[{"b", " ", "F", " ", "\[Gamma]"}], 
      RowBox[{
       RowBox[{"d", " ", 
        RowBox[{"(", 
         RowBox[{"d", "+", "F"}], ")"}], " ", 
        RowBox[{"(", 
         RowBox[{"d", "+", "\[Gamma]"}], ")"}]}], "+", 
       RowBox[{"d", " ", 
        RowBox[{"(", 
         RowBox[{"d", "+", "F", "+", "\[Gamma]"}], ")"}], " ", 
        "\[Lambda]"}]}]]}]}], "}"}], "}"}]], "Output"]
}, Open  ]],

Cell["\<\
Find seroprevalence at equilibrium (this is the data we have to work with)\
\>", "Text"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Rstar", " ", "=", " ", 
  RowBox[{
   RowBox[{"r", "/", 
    RowBox[{"(", 
     RowBox[{"b", "/", "d"}], ")"}]}], "/.", "eq"}]}]], "Input"],

Cell[BoxData[
 RowBox[{"{", 
  FractionBox[
   RowBox[{"d", " ", "F", " ", "\[Gamma]"}], 
   RowBox[{
    RowBox[{"d", " ", 
     RowBox[{"(", 
      RowBox[{"d", "+", "F"}], ")"}], " ", 
     RowBox[{"(", 
      RowBox[{"d", "+", "\[Gamma]"}], ")"}]}], "+", 
    RowBox[{"d", " ", 
     RowBox[{"(", 
      RowBox[{"d", "+", "F", "+", "\[Gamma]"}], ")"}], " ", "\[Lambda]"}]}]], 
  "}"}]], "Output"]
}, Open  ]],

Cell["\<\
Solve for the force of infection, F, in terms of seroprevalence.\
\>", "Text"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"foi", " ", "=", " ", 
  RowBox[{
   RowBox[{"FullSimplify", "[", 
    RowBox[{"Solve", "[", 
     RowBox[{
      RowBox[{"hsero", " ", "\[Equal]", " ", "Rstar"}], ",", " ", "F"}], 
     "]"}], "]"}], "//", "Flatten"}]}]], "Input"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"F", "\[Rule]", 
   RowBox[{"-", 
    FractionBox[
     RowBox[{"hsero", " ", 
      RowBox[{"(", 
       RowBox[{"d", "+", "\[Gamma]"}], ")"}], " ", 
      RowBox[{"(", 
       RowBox[{"d", "+", "\[Lambda]"}], ")"}]}], 
     RowBox[{
      RowBox[{"-", "\[Gamma]"}], "+", 
      RowBox[{"hsero", " ", 
       RowBox[{"(", 
        RowBox[{"d", "+", "\[Gamma]", "+", "\[Lambda]"}], ")"}]}]}]]}]}], 
  "}"}]], "Output"]
}, Open  ]],

Cell["\<\
The rate of new cases of Lassa is F*s. Calculate this, and rewrite everything \
in terms of seroprevalence.\
\>", "Text"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"NewCaseRate", " ", "=", " ", 
  RowBox[{"FullSimplify", "[", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{"F", "/.", "foi"}], ")"}], "*", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"s", "/.", "eq"}], "/.", "foi"}], ")"}]}], "]"}]}]], "Input"],

Cell[BoxData[
 RowBox[{"{", 
  FractionBox[
   RowBox[{"b", " ", "hsero", " ", 
    RowBox[{"(", 
     RowBox[{"d", "+", "\[Gamma]"}], ")"}], " ", 
    RowBox[{"(", 
     RowBox[{"d", "+", "\[Lambda]"}], ")"}]}], 
   RowBox[{"d", " ", "\[Gamma]"}]], "}"}]], "Output"]
}, Open  ]],

Cell["\<\
Find the overall effect of reinfection on case-rate estimate.\
\>", "Text"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"NewCaseRate", "/", 
  RowBox[{"(", 
   RowBox[{"NewCaseRate", "/.", 
    RowBox[{"\[Lambda]", "\[Rule]", "0"}]}], ")"}]}]], "Input"],

Cell[BoxData[
 RowBox[{"{", 
  FractionBox[
   RowBox[{"d", "+", "\[Lambda]"}], "d"], "}"}]], "Output"]
}, Open  ]],

Cell[TextData[{
 "Reinfection multiplies the case rate by ",
 Cell[BoxData[
  FormBox[
   FractionBox[
    RowBox[{"d", "+", "\[Lambda]"}], "d"], TraditionalForm]]]
}], "Text"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Estimate the effect of reinfection on total case numbers", "Subchapter"],

Cell["\<\
Assume the population of west Africa is 11 million, 16% of individuals have \
Lassa antibodies (average across all data), lifespan is 50 years, and Lassa \
recovery rate is 1 month. \
\>", "Text"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Pars", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"hsero", "\[Rule]", "0.16"}], ",", " ", 
     RowBox[{"d", "\[Rule]", " ", "0.02"}], ",", " ", 
     RowBox[{"\[Gamma]", "\[Rule]", " ", "12"}]}], "}"}]}], ";"}]], "Input"],

Cell["\<\
Find the ratio of estimates of new cases with (\[Lambda] = 0.064) and without \
(\[Lambda] = 0) seroreversion. \
\>", "Text"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"(", 
    RowBox[{"NewCaseRate", "/.", 
     RowBox[{"\[Lambda]", "\[Rule]", "0.064"}]}], ")"}], "/", 
   RowBox[{"(", 
    RowBox[{"NewCaseRate", "/.", 
     RowBox[{"\[Lambda]", "\[Rule]", "0"}]}], ")"}]}], "/.", 
  "Pars"}]], "Input"],

Cell[BoxData[
 RowBox[{"{", "4.2`", "}"}]], "Output"]
}, Open  ]]
}, Open  ]]
}, Open  ]]
},
WindowSize->{Full, Full},
WindowMargins->{{Automatic, 58}, {Automatic, 18}},
Visible->True,
ScrollingOptions->{"VerticalScrollRange"->Fit},
ShowCellBracket->Automatic,
CellContext->Notebook,
TrackCellChangeTimes->False,
FrontEndVersion->"11.0 for Mac OS X x86 (32-bit, 64-bit Kernel) (September \
21, 2016)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 38, 0, 92, "Title"],
Cell[621, 24, 131, 3, 30, "Text"],
Cell[CellGroupData[{
Cell[777, 31, 34, 0, 63, "Subchapter"],
Cell[814, 33, 73, 0, 30, "Text"],
Cell[890, 35, 702, 20, 75, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[1629, 60, 84, 1, 63, "Subchapter"],
Cell[1716, 63, 37, 0, 30, "Text"],
Cell[CellGroupData[{
Cell[1778, 67, 412, 11, 32, "Input"],
Cell[2193, 80, 1547, 48, 47, "Output"]
}, Open  ]],
Cell[3755, 131, 98, 2, 30, "Text"],
Cell[CellGroupData[{
Cell[3878, 137, 163, 5, 32, "Input"],
Cell[4044, 144, 400, 13, 47, "Output"]
}, Open  ]],
Cell[4459, 160, 88, 2, 30, "Text"],
Cell[CellGroupData[{
Cell[4572, 166, 254, 7, 32, "Input"],
Cell[4829, 175, 457, 15, 47, "Output"]
}, Open  ]],
Cell[5301, 193, 131, 3, 30, "Text"],
Cell[CellGroupData[{
Cell[5457, 200, 269, 8, 32, "Input"],
Cell[5729, 210, 267, 8, 47, "Output"]
}, Open  ]],
Cell[6011, 221, 85, 2, 30, "Text"],
Cell[CellGroupData[{
Cell[6121, 227, 156, 4, 32, "Input"],
Cell[6280, 233, 103, 3, 46, "Output"]
}, Open  ]],
Cell[6398, 239, 176, 6, 39, "Text"]
}, Open  ]],
Cell[CellGroupData[{
Cell[6611, 250, 78, 0, 63, "Subchapter"],
Cell[6692, 252, 206, 4, 30, "Text"],
Cell[6901, 258, 263, 7, 32, "Input"],
Cell[7167, 267, 135, 3, 30, "Text"],
Cell[CellGroupData[{
Cell[7327, 274, 283, 9, 32, "Input"],
Cell[7613, 285, 53, 1, 32, "Output"]
}, Open  ]]
}, Open  ]]
}, Open  ]]
}
]
*)

(* End of internal cache information *)

